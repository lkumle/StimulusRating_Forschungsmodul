<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title> 
		<script src="jspsych-6.0.4/jspsych.js"></script>
		<script src="jspsych-6.0.4/plugins/jspsych-html-keyboard-response.js"></script>
		<script src="jspsych-6.0.4/plugins/jspsych-image-keyboard-response.js"></script>
		<script src="jspsych-6.0.4/plugins/jspsych-fullscreen.js"></script>
		<link href="jspsych-6.0.4/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body style="background-color:lightgrey;">
	</body>
	<script>
	
		var timeline = []; 
		
		// randomly generate subject ID as combination of 15 letters and numbers
		var subject_id = jsPsych.randomization.randomID(15);
		
		/* present fullscreen*/
		timeline.push({
			type: 'fullscreen',
			fullscreen_mode:true,
			message: "<div>Bitte klicken Sie auf 'Weiter', um das Experiment im Vollbild-Modus zu sehen. </div><div>Der Vollbild-Modus endet nach Ende des Experiments automatisch.</div>",
			button_label: "<p>Weiter</p>"
		});
		
		/*Welcome text presentation*/
		
		var welcome = {
			type: "html-keyboard-response", 
			stimulus: "<p>Herzlich Willkommen! Vielen Dank für Ihre Teilnahme an diesem Experiment.</p>" +
			"<p>Drücken Sie eine beliebige Taste, um die Aufgabe kennenzulernen.</p>"
			};
		timeline.push(welcome);
		
		
		/*Instructions*/
		
		var c1 = ~~(Math.random()*2) ? "gutes" : "schlechtes"
		var c_dict = {	"gutes": "schlechtes",
						"schlechtes": "gutes"}
		
		var c2 = c_dict[c1]
		
		var text = "<p>In diesem Experiment werden Ihnen Bilder von Wolken gezeigt.</p>"+
		        "<p>Ihre Aufgabe ist es, zu bewerten, ob es sich Ihrer Meinung nach"+
		        "um gutes oder schlechtes Wetter handelt.</p>"+
				"<p>Handelt es sich Ihrer Meinung nach um <strong>" + c1 +
				"</strong> Wetter, druecken Sie die Taste <strong>J</strong> mit dem rechten Zeigefinger.</p>"+
				"<p>Handelt es sich Ihrer Meinung nach um <strong>" + c2 +
				"</strong> Wetter, druecken Sie die Taste <strong>F</strong> mit dem linken Zeigefinger.</p>"+
 				"<p>Fuer Ihre Antwort gibt es keine Zeitbegrenzung.</p>"+
 				"<div style='float: middle;'><img src='test_himmel_2.png'></img>" +
 				"</div>"+
				"<p>Druecken Sie eine beliebige Taste, um mit einigen Uebungsdurchgaengen zu beginnen.</p>"
		
		var instructions = {
								type: 'html-keyboard-response',
								stimulus: text
							};
		timeline.push(instructions);
		
		
		
		// variable condi containing the condition of the subject in text form
		var condi = "J = "+c1.replace("es", "");
		
		// logging subject_id and condition in each trial
		jsPsych.data.addProperties({ID: subject_id, condition: condi});
		
		
		
		/*Define trial components*/
		var test_stimuli = [
			{stimulus: "<div><img src='test_himmel_2.png' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"},
			{stimulus: "<div><img src='test_himmel_3.png' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"},
			{stimulus: "<div><img src='test_himmel_4.png' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"}
			];
			
		var fixation = {
			type: 'html-keyboard-response',
			stimulus: '<div style="font-size:60px;">+</div>',
			choices: ["q"],
			trial_duration: 500,
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.endExperiment("<div>Sie haben sich entschieden, das Experiment abzubrechen. Nichts der von Ihnen während Ihrer Teilnahme gesammelten Daten wurde gespeichert.<div/><div>Vielen Dank für Ihre (teilweise) Teilnahme!</div>")
					} // end if-statement	
				} // end function(data)
			}

		var choice = {
			type: "html-keyboard-response",
			stimulus: jsPsych.timelineVariable('stimulus'),
			choices: ['f', 'j', 'q'], // corresponding to 70, 74 and 81 in js key code, respectively (and the key code is logged)
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.endExperiment("<div>Sie haben sich entschieden, das Experiment abzubrechen. Nichts der von Ihnen während Ihrer Teilnahme gesammelten Daten wurde gespeichert.<div/><div>Vielen Dank für Ihre (teilweise) Teilnahme!</div>")
					} // end if-statement	
				} // end function(data)
			}
			
		var iti = {
			type: 'html-keyboard-response', 
			stimulus: '<div></div>', 
			choices: ["q"],
			trial_duration: 500,
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.endExperiment("<div>Sie haben sich entschieden, das Experiment abzubrechen. Nichts der von Ihnen während Ihrer Teilnahme gesammelten Daten wurde gespeichert.<div/><div>Vielen Dank für Ihre (teilweise) Teilnahme!</div>")
					} // end if-statement	
				} // end function(data)	
			}

		var test_procedure = {
			timeline: [fixation, choice, iti],
			timeline_variables: test_stimuli, 
			randomize_order: true,
			}

		timeline.push(test_procedure);
		
		var end_of_practice = {
			type: "html-keyboard-response", 
			stimulus: "<p>Das waren die Übungsdurchgänge</p>" +
			"<p>Drücken Sie eine beliebige Taste, um mit der eigentlichen Aufgabe zu beginnen.</p>"
			};
			
		timeline.push(end_of_practice);
		
		/*ab hier das echte Experiment*/
		
		var stimuli = [
		{stimulus: "<div><img src='H1.png' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"},
		{stimulus: "<div><img src='H2.jpg' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"},
		{stimulus: "<div><img src='H3.jpg' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"},
		{stimulus: "<div><img src='H4.jpg' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"},
		{stimulus: "<div><img src='H5.jpg' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"},
		{stimulus: "<div><img src='H6.jpg' width='600' height='400'></img></div>" + 
			"<div><img src='thumbs.png' width='300' height='150'></img></div>"}
		];
		
		var procedure = {
			timeline: [fixation, choice, iti],
			timeline_variables: stimuli, 
			randomize_order: true,
		}
		
		timeline.push(procedure);
		
			
		var goodbye = {
			type: "html-keyboard-response", 
			stimulus: "<p>Das Experiment ist nun zu Ende. Vielen Dank für Ihre Teilnahme!</p>" +
			"<p>Drücken Sie eine beliebige Taste, um die Aufgabe zu beenden. Anschließend können Sie das Browser-Fenster schließen.</p>"
			};
			
		timeline.push({
			type: 'fullscreen',
			fullscreen_mode: false 
			});

		timeline.push(goodbye);
		
		jsPsych.init({
			timeline:timeline,
			on_finish:function() {jsPsych.data.displayData();}
			
		
		});
			
				
	</script>  
</html>
