<!DOCTYPE html>
<html>
    <head>
	<meta charset="utf-8"/>    
        <title>Experiment</title> 
		<script src="jspsych-6.0.4/jspsych.js"></script>
		<script src="jspsych-6.0.4/plugins/jspsych-html-keyboard-response.js"></script>
		<script src="jspsych-6.0.4/plugins/jspsych-image-keyboard-response.js"></script>
	    	<script src="jspsych-6.0.4/plugins/jspsych-survey-text.js"></script>
	    	<script src="jspsych-6.0.4/plugins/jspsych-survey-multi-choice.js"></script>
		<script src="jspsych-6.0.4/plugins/jspsych-fullscreen.js"></script>
	    	<script src="jspsych-6.0.4/plugins/jspsych-resize.js"></script>
		<script src="jspsych-6.0.4/plugins/jspsych-html-button-response.js"></script>
		<link href="jspsych-6.0.4/css/jspsych.css" rel="stylesheet" type="text/css"></link>
		<style>
		    dl dd { margin-bottom: 20px; }; /* just for the "bullet points" in the consent part*/
		</style>
    </head>
    <body style="background-color:lightgrey;">
	</body>
	<script>
	
		 /*******************/
		/* Create Timeline */
	       /*******************/
		var timeline = []; 
		
		
		 /*********************/
		/* Create Subject-ID */
	       /*********************/
		var subject_id = jsPsych.randomization.randomID(15);
		
		
		 /************************/
		/* Randomize Conditions */
	       /************************/	
		var b1 = ~~(Math.random()*2) ? "clouds" : "muffins";
		var c1 = ~~(Math.random()*2) ? "gutes" : "schlechtes";
		var c_dict = {	"gutes": "schlechtes","schlechtes": "gutes"}
		var c2 = c_dict[c1]
		var condi_keys = "J = "+c1.replace("es", "");
		var condi_order = b1 + "_first";
		
		
		 /********************************/
		/* Save Subject-ID & Conditions */
	       /********************************/
		jsPsych.data.addProperties({ID: subject_id, condition_order: condi_order, condition_keys: condi_keys});
		


		 /*********************/
		/* All stimulus sets */
	       /*********************/	

		// for test-procedure
		var test_clouds = [
			{stimulus: "<div><img src='test_himmel_2.png' width='900' height='600' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='test_himmel_3.png' width='900' height='600' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='test_himmel_4.png' width='900' height='600' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				}
			];
	
			
		var test_muffins = [
			{stimulus: "<div><img src='test_muffin2.png' width='600' height='400' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='test_muffin3.png' width='600' height='400' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='test_muffin4.png' width='600' height='400' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				}
			];	
		
		// for main procedure
		var clouds_stimuli = [
			{stimulus: "<div><img src='H1.png' width='900' height='600' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='H2.jpg' width='900' height='600' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='H3.jpg' width='900' height='600' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='H4.jpg' width='900' height='600' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='H5.jpg' width='900' height='600' position:absolute left:50% top:50%></img></div>"
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='H6.jpg' width='900' height='600' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-70%; margin-top:15%;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:70%; margin-top:15%; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				}
			];
		
		var muffins_stimuli = [
			{stimulus: "<div><img src='M1.png' width='600' height='400' position:absolute left:50% top:50%></img></div>"
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"	
				},
			{stimulus: "<div><img src='M2.png' width='600' height='400' position:absolute left:50% top:50%></img></div>"
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='M3.png' width='600' height='400' position:absolute left:50% top:50%></img></div>"
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='M4.png' width='600' height='400' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='M5.png' width='600' height='400' position:absolute left:50% top:50%></img></div>"
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				},
			{stimulus: "<div><img src='M6.png' width='600' height='400' position:absolute left:50% top:50%></img></div>" 
				+ "<div style='position:absolute; margin-left:-630px; margin-top:237px;text-align:center;width:100%'><p style='font-size:22px; '>"+c2.replace("es", "")
				+"<br><small>F</small></p></div>"
				+ "<div style='position: absolute; margin-left:630px; margin-top:237px; text-align:center;width:100%'><p style='font-size:22px; '>"+c1.replace("es","")+"<br><small>J</small></p></div>"
				}
			];
		
		
		
		
		 /*********************/
		/* Task Instructions */
	       /*********************/
		
		var instruct_clouds = "<p style='font-size:26px;'>In diesem Experiment werden Ihnen Himmelsbilder gezeigt.</p>"+
			"<p style='font-size:26px;'>Ihre Aufgabe ist es, zu bewerten, ob es sich Ihrer Meinung nach "+
			"um gutes oder schlechtes Wetter handelt.</p>"+
			"<p style='font-size:26px;'>Handelt es sich Ihrer Meinung nach um <strong>" + c1 +
			"</strong> Wetter, drücken Sie die Taste <strong>J</strong> mit dem rechten Zeigefinger.</p>"+
			"<p style='font-size:26px;'>Handelt es sich Ihrer Meinung nach um <strong>" + c2 +
			"</strong> Wetter, drücken Sie die Taste <strong>F</strong> mit dem linken Zeigefinger.</p>"+
 			"<p style='font-size:26px;'>Für Ihre Antwort gibt es keine Zeitbegrenzung.</p>"+
 			"<div style='float: middle;'><img src='test_himmel_2.png'></img>" +
 			"</div>"+
			"<p style='font-size:26px;'>Drücken Sie eine beliebige Taste, um mit einigen Übungsdurchgängen zu beginnen.</p>";
		
		var instruct_muffins = "<p style='font-size:26px;'>In diesem Experiment werden Ihnen Bilder von Muffins gezeigt.</p>"+
		    	"<p style='font-size:26px;'>Ihre Aufgabe ist es, zu bewerten, ob es dem Muffin Ihrer Meinung nach "+
		    	"gut oder schlecht geht.</p>"+
		    	"<p style='font-size:26px;'>Geht es dem Muffin Ihrer Meinung nach <strong>" + c1.replace("es", "") +
			"</strong>, drücken Sie die Taste <strong>J</strong> mit dem rechten Zeigefinger.</p>"+
			"<p style='font-size:26px;'>Geht es dem Muffin Ihrer Meinung nach <strong>" + c2.replace("es", "") +
			"</strong>, drücken Sie die Taste <strong>F</strong> mit dem linken Zeigefinger.</p>"+
 			"<p style='font-size:26px;'>Für Ihre Antwort gibt es keine Zeitbegrenzung.</p>"+
 			"<div style='float: middle;'><img src='test_muffin1.png'></img>" +
 			"</div>"+
			"<p style='font-size:26px;'>Drücken Sie eine beliebige Taste, um mit einigen Übungsdurchgängen zu beginnen.</p>";
		
		
	  	 /***********************/
		/* Consent Information */
	       /***********************/
		
		var consent_information = "<div style='margin-bottom:20px; font-size:16px;'><h2>Einwilligung und Studieninformationen</h2>"+
			"<dl><dt><strong>Studieninformation</strong></dt><dd>In dieserm kleinen Experiment werden Ihnen Bilder von Wolken und Muffins gezeigt, welche Sie via Tastendruck bewerten sollen. Außerdem würden wir am Ende gerne Ihr Alter und Ihr Geschlecht erfahren.</dd>"
			+ "<dt><strong>Wissenschaftliche Ziele</strong></dt>"+
			"<dd>Dieses kleine Experiment dient der Auswahl geeigneter Bilder für eine Studie zur Interpretation uneindeutiger Inhalte.</dd><dt><strong>Persönlicher Nutzen</strong></dt>"+
			"<dd>Die Teilnahme an diesem Experiment kann leider nicht entlohnt werden. Wir danken Ihnen umso mehr vielmals für Ihre Teilnahme. </dd>"+
			"<dt><strong>Freiwilligkeit</strong></dt>"+
			"<dd>Die Teilnahme an diesem Experiment ist vollkommen freiwillig. Sie können Ihre Teilnahme jederzeit ohne Angabe von Gruenden beenden, ohne dass Ihnen dadurch Nachteile entsehen. Um das Experiment zu abzubrechen, drücken Sie jederzeit während des Experiments die Taste 'q'. Alternativ drücken Sie bitte 'Esc'. In beiden Fällen können Sie das Browser-Fenster anschließend einfach schließen, ohne dass irgendwelche Ihrer Angaben gespeichert werden.</dd>"+
			"<dt><strong>Datensicherung und Datenschutz</strong></dt>"+
			"<dd>Im Zuge dieses Experiments werden <i>keinerlei</i> personen-identifizierende Daten (wie etwa IP-Adressen o. ä.) erhoben. Das heißt, die Daten (z. B. Ihr Tastendruck bei jedem der gezeigten Bilder) werden in rein anonymisierter Form abgespeichert und erlauben keine Rückschlüsse auf Ihre Person oder Ihren Standort. Die Daten werden auf einem lokalen Server an der Universität Frankfurt in einem Ordner gespeichert, der ausschließlich den Studienmitarbeitern zugänglich ist. </dd>"+
			"</dl></div>"+"<div style='font-size:16px;'><p style='margin:0px; font-size:16px;'><br><br><i>Wenn Sie mit den obenstehenden Informationen einverstanden sind, klicken Sie bitte auf 'Einverstanden',  um an diesem Experiment teilzunehmen.</i></p><p style='margin:0px; font-size:16px;'><i>Wenn Sie mit den obenstehenden Informationen nicht einverstanden sind, klicken Sie bitte auf 'Nicht einverstanden', um das Experiment abzubrechen.</i></p></div>";

			
			
			
	   /************************/
		/**** Resize-Instruct ***/
	 /************************/		
		
		var resize_text = "<p style='font-size:16px;'>Um die Bilder, welche Sie gleich sehen werden, in der für Ihren Bildschirm richtigen Größe darstellen zu können,</p>" + "<p style='font-size:16px;'>bitten wir Sie, sich nun eine Bankkarte zur Hand zu nehmen. Halten Sie die Karte direkt vor das blaue Feld</p>"+
			"<p style='font-size:16px;'> und ziehen Sie die rechte untere Ecke des Feldes so weit, dass es der Größe Ihrer Bankkarte entspricht.</p>"+
			"<p style='margin-top: 30px; font-size:16px'>Wenn Sie bereit sind, klicken Sie bitte auf 'Weiter'.</p>"
	
			
			
	   /************************/
		/* Concentrate-Instruct */
	 /************************/		
		var concentrate_text = "<p style='font-size:26px;'>Für unsere Untersuchung ist es wichtig, dass Sie die folgenden Aufgaben <strong>ungestört</strong> bearbeiten können.</p>" + "<p style='font-size:26px;'>Wir bitten Sie daher, sich für die Bearbeitung der folgenden beiden Aufgaben an einen ruhigen Ort zu begeben</p><p style='font-size:26px;'> und nach Möglichkeit keine weiteren Aktivitäten parallel zu verfolgen.</p><p style='font-size:26px;'> <strong>Vielen Dank!!</strong></p>"+ "<p style='font-size:26px;'>Klicken Sie auf 'Ich bin bereit', um mit der ersten Aufgabe zu starten.</p>";

						
		
		 /*************************/
		/*Define trial components*/
	 /*************************/
		
		// Fullscreen info
		var start_fullscreen = {
			type: 'fullscreen',
			fullscreen_mode:true,
			message: "<div>Bitte klicken Sie auf 'Weiter', um das Experiment im Vollbild-Modus zu sehen.</div>"+
			"<div>Der Vollbild-Modus endet nach Ende des Experiments automatisch. Andernfalls können Sie den Vollbild-Modus jederzeit durch Drücken von 'Esc' beenden.</div>",
			button_label: "Weiter"
		};
		
		// Welcome trial
		var welcome = {
		    type: "html-keyboard-response", 
			stimulus: "<h4><p style='font-size:16px;'>Herzlich Willkommen! Vielen Dank für Ihre Teilnahme an diesem Experiment.</p></h4>" +
			"<p style='font-size:16px;'>Dieses Experiment besteht aus zwei Aufgaben.</p>"+
			"<p style='font-size:16px;'>Drücken Sie eine beliebige Taste, um fortzufahren.</p>"
			};	
			
		// Study Information and Consent
		var consent_info = {
			type: 'html-button-response',
			stimulus: consent_information,
			margin_vertical: '2px',
			choices: ["Nicht einverstanden.", "Einverstanden."],
			on_finish: function(data){
				if(data.button_pressed == "0"){
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.<div/><div>Vielen Dank!</div>")}
				}
			};
			
			
		// Resize trial
		var resize = {
			type: 'resize',
			item_width: 3 + 3/8,
			item_height: 2 + 1/8,
			prompt: resize_text,
			pixels_per_unit: 150,
			button_label: "<p style='font-size:16px;'>Weiter</p>"
			};	
			
			
		// concentrate trials
		var concentrate = {
			type: "html-button-response", 
			stimulus: concentrate_text,
			margin_vertical:'15px',
			choices:["<p style='font-size:20px'>Ich bin bereit</p>", "<p style='font-size:20px'>Ich kann gerade doch nicht</p>"],
			on_finish: function(data){
				if(data.button_pressed == "1"){
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div><p style='font-size:30px;'>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.</p></div><div><p style='font-size:30px;'>Vielen Dank!</p></div>")}
				}			
			};	
		
			
		// Instruction trial
		var instructions = {
			type: 'html-keyboard-response',
			stimulus: instruct_clouds,
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div><p style='font-size:30px;'>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.</p></div><div><p style='font-size:30px;'>Vielen Dank!</p></div>")
					} // end if-statement	
				} // end function(data)					
			};
		
		
		// Fixation cross
		var fixation = {
			type: 'html-keyboard-response',
			stimulus: '<div style="font-size:100px;">+</div>',
			choices: ["q"],
			trial_duration: 500,
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div><p style='font-size:30px;'>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.</p></div><div><p style='font-size:30px;'>Vielen Dank!</p></div>")
					} // end if-statement	
				} // end function(data)
			};

		// Task Choice
		var choice = {
			type: "html-keyboard-response",
			stimulus: jsPsych.timelineVariable('stimulus'),
			choices: ['f', 'j', 'q'], // corresponding to 70, 74 and 81 in js key code, respectively (and the key code is logged)
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div><p style='font-size:30px;'>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.</p></div><div><p style='font-size:30px;'>Vielen Dank!</p></div>")

					} // end if-statement	
				} // end function(data)
			};
		
		// ITI
		var iti = {
			type: 'html-keyboard-response', 
			stimulus: '<div></div>', 
			choices: ["q"],
			trial_duration: 500,
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div><p style='font-size:30px;'>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.</p></div><div><p style='font-size:30px;'>Vielen Dank!</p></div>")
					} // end if-statement	
				} // end function(data)	
			};

		// Practice Trials (combined)
		var test_procedure = {
			timeline: [fixation, choice, iti],
			timeline_variables: test_clouds, 
			randomize_order: true,
			};
	
		// End-of-Practice-Trials Trial
		var end_of_practice = {
			type: "html-keyboard-response", 
			stimulus: "<p style='font-size:30px;'>Das waren die Übungsdurchgänge.</p>" +
			"<p style='font-size:30px;'>Drücken Sie eine beliebige Taste, um mit der eigentlichen Aufgabe zu beginnen.</p>",
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div><p style='font-size:30px;'>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.</p></div><div><p style='font-size:30px;'>Vielen Dank!</p></div>")
					} // end if-statement	
				} // end function(data)				
			};
	
		// Experiment Trials (combined)
		var procedure = {
			timeline: [fixation, choice, iti],
			timeline_variables: clouds_stimuli, 
			randomize_order: true,
		};
		
		
		// Start Task 2
		var pause = {
		    type: "html-keyboard-response", 
			stimulus: "<p style='font-size:30px;'>Die erste Aufgabe ist geschafft, vielen Dank!</p><p style='font-size:30px;'> Gerne können Sie eine kleine Pause einlegen, bevor Sie mit der zweiten Aufgabe starten.</p>"+ "<p style='font-size:30px;'><br><br><br>Wenn Sie bereit sind, drücken Sie eine beliebige Taste, um mit der zweiten Aufgabe fortzufahren.</p>",
			on_finish: function(data){
				if(data.key_press == 81){ // 81 is js key code for "q", which we use as an exit button
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div><p style='font-size:30px;'>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.</p></div><div><p style='font-size:30px;'>Vielen Dank!</p></div>")
					} // end if-statement	
				} // end function(data)				
			};	
			
		
		// Clone/Copy instructions, procedure and test_procedure for SECOND BLOCK
		var instructions2 = Object.assign({}, instructions);
		var test_procedure2 = Object.assign({}, test_procedure);
		var procedure2 = Object.assign({}, procedure);
		
		// Age question
		var age = {
			type: "survey-text",
			questions: [{prompt: "<p style='font-size:20px;'>Geben Sie hier bitte Ihr Alter an:</p>", rows:1, columns:6}], 
			button_label: "<p style='font-size:16px;'>Weiter</p>"
		};
		
		// Gender question
		var options_gender = ["<strong>männlich</strong>", "<strong>weiblich</strong>"] ;// ["maennlich", "weiblich"]; 
		var gender = {
			type: "survey-multi-choice",
			questions: [{prompt: "<p style='font-size:26px;'>Geben Sie hier bitte Ihr Geschlecht an:</p>", options: options_gender}],
			button_label: "Weiter" //"<p>Weiter</p>" --> doesn't work
		};
		
		
		// Ask if subjects got disturbed during the experiment
		var ask_concentrate = {
			type: "html-button-response",
			stimulus: "<p style='font-size:26px;'>Konnten Sie die Aufgabe ungestört bearbeiten?</p>",
			margin_vertical:"25px",
			choices:["<p style='font-size:20px;'>Ja, ich konnte die Aufgabe ungestört bearbeiten.</p>", "<p style='font-size:20px;'>Nein, ich wurde gestört.</p>", "<p style='font-size:20px;'>Nein, bitte verwerfen Sie alle meine Angaben.</p>"],
			on_finish: function(data){
				if(data.button_pressed == "2"){
					jsPsych.data.get().addToLast({ID: 'abort'});
					jsPsych.endExperiment("<div><p style='font-size:30px;'>Sie haben sich entschieden, das Experiment abzubrechen. Keine Ihrer Angaben wurde gespeichert.</p></div><div><p style='font-size:30px;'>Vielen Dank!</p></div>")}
				}				
		};
		
		
		// End Fullscreen
		var end_fullscreen = {
			type: 'fullscreen',
			fullscreen_mode: false 
		};
		
		// Goodbye/End of Experiment
		var goodbye = {
			type: "html-keyboard-response", 
			stimulus: "<p style='font-size:25px;'>Das Experiment ist nun zu Ende. Druecken Sie eine beliebige Taste, um die Aufgabe zu beenden.</p>" +
			"<p style='font-size:25px;'> Vielen Dank für Ihre Teilnahme!</p>"
		};
		
		
		
		
		 /*******************/
		/* CREATE TIMELINE */
	       /*******************/
		
		timeline.push(start_fullscreen);	
		timeline.push(welcome);
		timeline.push(consent_info);
		timeline.push(resize);
		timeline.push(concentrate);
		
		//MODIFY FIRST BLOCK (instructions, test_procedure, procedure) depending on condition:	
		if(b1 == "muffins"){
			instructions.stimulus = instruct_muffins;
			test_procedure.timeline_variables = test_muffins;
			procedure.timeline_variables = muffins_stimuli;
		};
		
		timeline.push(instructions);
		timeline.push(test_procedure);
		timeline.push(end_of_practice); // stays the same for all conditions
		timeline.push(procedure);
		
		//Pause between tasks
		timeline.push(pause);
		
		
		//MODIFY SECOND BLOCK: (instructions2, test_procedure2, procedure2) depending on condition:	
		if(b1 == "muffins"){
			instructions2.stimulus = instruct_clouds;
			test_procedure2.timeline_variables = test_clouds;
			procedure2.timeline_variables = clouds_stimuli;
		} else 	if(b1 == "clouds"){
			instructions2.stimulus = instruct_muffins;
			test_procedure2.timeline_variables = test_muffins;
			procedure2.timeline_variables = muffins_stimuli;				
		}	
		
		
		timeline.push(instructions2);
		timeline.push(test_procedure2);
		timeline.push(end_of_practice); // stays the same for all conditions
		timeline.push(procedure2);	
		timeline.push(age);
		timeline.push(gender);
		timeline.push(ask_concentrate);		
		timeline.push(end_fullscreen);
		timeline.push(goodbye);
		
		
		
		 /****************************/
		/* Function for data saving */
	       /****************************/
				
		function saveData(name, data){
		  var xhr = new XMLHttpRequest();
		  xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
		  xhr.setRequestHeader('Content-Type', 'application/json');
		  xhr.send(JSON.stringify({filename: name, filedata: data}));
		}
		
		
		 /***********************/
		/* Define outfile name */
	       /***********************/
		var outfile = "ibi_CloudsMuffinsRating_" + subject_id;
		
		
		 /**************************/
		/* Initialise Experiment! */
	       /**************************/
		jsPsych.init({
			timeline:timeline,
			on_finish: function(){ 
				if (jsPsych.data.getLastTrialData().select('ID').values[0] != 'abort') {saveData(outfile, jsPsych.data.getLastTrialData().csv()); }; // i.e. actually save the data
				if (jsPsych.data.getLastTrialData().select('ID').values[0] == 'abort'){saveData(outfile, " "); } // i.e. do NOT save data if subject has aborted the experiment
			} 
			
			// use the following instead, if running without active web server:
				//on_finish:function() {jsPsych.data.displayData();}				
		});

					
	</script>  
</html>

